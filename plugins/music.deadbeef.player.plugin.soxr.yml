app-id: music.deadbeef.player.plugin.soxr
runtime: music.deadbeef.player
sdk: org.gnome.Sdk//46
build-extension: true

modules:
  - name: soxr
    buildsystem: cmake-ninja
    sources:
      - type: git
        url: https://github.com/chirlu/soxr.git
        tag: 0.1.3
    config-opts:
      - -DCMAKE_INSTALL_PREFIX=/app/extensions/soxr

  - name: deadbeef_soxr
    builddir: true
    buildsystem: simple
    build-commands:
      - mkdir -p deadbeef/
      - tar -xf ddb-headers-latest.tar.bz2 -C deadbeef/
      - gcc -I/usr/include -I./deadbeef -std=c99 -shared -O2 -o ddb_soxr_dsp.so  soxr.c -lsoxr -fPIC -Wall -march=native -I./soxr/src -L/app/extensions/soxr/lib
      - install -Dm755 ddb_soxr_dsp.so /app/extensions/soxr/ddb_soxr_dsp.so
    sources:
      - type: git
        url: https://github.com/silentlexx/deadbeef_soxr.git
        branch: master
      - type: git
        url: https://github.com/chirlu/soxr.git
        tag: 0.1.3
        dest: soxr/
      - type: file
        url: https://master.dl.sourceforge.net/project/deadbeef/staticdeps/ddb-headers-latest.tar.bz2
        sha256: e86ee7fb8c8347168c769eeb82b6a0ea9aca55d2688a4f79726a63fc7dd04289
